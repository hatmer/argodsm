<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ArgoDSM - Software Distributed Shared Memory: /home/atmerhannah/argodsm/src/backend/mpi/coherence.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ArgoDSM - Software Distributed Shared Memory
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_3f615ade772d23cefe5e20dcb18424a2.html">backend</a></li><li class="navelem"><a class="el" href="dir_cd56f9bb444c4dcc895557544c79ce2a.html">mpi</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">coherence.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="coherence_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;../backend.hpp&quot;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="swdsm_8h.html">swdsm.h</a>&quot;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="write__buffer_8hpp.html">write_buffer.hpp</a>&quot;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="virtual__memory_8hpp.html">virtual_memory/virtual_memory.hpp</a>&quot;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// EXTERNAL VARIABLES FROM BACKEND</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"></span><span class="keyword">extern</span> <a class="code" href="structmyControlData.html">control_data</a> *<a class="code" href="coherence_8cpp_a47bd1cf6b67fdc3919a12b2c622b0ae9.html#a47bd1cf6b67fdc3919a12b2c622b0ae9">cacheControl</a>;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">extern</span> std::uint64_t *<a class="code" href="coherence_8cpp_a8c349e3402bea4a398112f54fcfb7a0a.html#a8c349e3402bea4a398112f54fcfb7a0a">globalSharers</a>;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keyword">extern</span> pthread_mutex_t <a class="code" href="coherence_8cpp_a2827de70f5388ba0f94110dccfde2f6e.html#a2827de70f5388ba0f94110dccfde2f6e">cachemutex</a>;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">extern</span> sem_t <a class="code" href="coherence_8cpp_aecf80b1a87818049bb218f1029cbb271.html#aecf80b1a87818049bb218f1029cbb271">ibsem</a>;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">extern</span> <span class="keywordtype">char</span> * <a class="code" href="coherence_8cpp_a2707676433880430ff68f81f289f75b7.html#a2707676433880430ff68f81f289f75b7">barwindowsused</a>;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keyword">extern</span> MPI_Win *<a class="code" href="coherence_8cpp_aee30617402d0ccff2e61bc63a2a7b453.html#aee30617402d0ccff2e61bc63a2a7b453">globalDataWindow</a>;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">extern</span> MPI_Win <a class="code" href="coherence_8cpp_a52f5368613b8fb6e411ed9e2e738d97e.html#a52f5368613b8fb6e411ed9e2e738d97e">sharerWindow</a>;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="keyword">extern</span> <a class="code" href="structargo__statisticsStruct.html">argo_statistics</a> <a class="code" href="coherence_8cpp_a5a165c3e2fa2511a6beea1dcb9b7462e.html#a5a165c3e2fa2511a6beea1dcb9b7462e">stats</a>;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="keyword">extern</span> <a class="code" href="swdsm_8h_a7c9ba35a9f54dd8fa5a49d55e2768763.html#a7c9ba35a9f54dd8fa5a49d55e2768763">argo_byte</a> *<a class="code" href="coherence_8cpp_ac87b1e995ffe192a9cdd46c1686686c0.html#ac87b1e995ffe192a9cdd46c1686686c0">touchedcache</a>;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keyword">extern</span> MPI_Comm <a class="code" href="coherence_8cpp_ac506762549d2e2cd58c67e8f46428ea1.html#ac506762549d2e2cd58c67e8f46428ea1">workcomm</a>;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="keyword">extern</span> <a class="code" href="classwrite__buffer.html">write_buffer&lt;std::size_t&gt;</a>* <a class="code" href="coherence_8cpp_aa2b2930f8400209562515c100a4ed0da.html#aa2b2930f8400209562515c100a4ed0da">argo_write_buffer</a>;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceargo.html">argo</a> {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keyword">namespace </span>backend {</div><div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="backend_8hpp_a0fb29a8253f0d9aefc999d93414b1758.html#a0fb29a8253f0d9aefc999d93414b1758">   73</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="backend_8hpp_a0fb29a8253f0d9aefc999d93414b1758.html#a0fb29a8253f0d9aefc999d93414b1758">_selective_acquire</a>(<span class="keywordtype">void</span> *addr, std::size_t <a class="code" href="tests_2allocators_8cpp_aa66b7725a5567b78a94e77bd286ca137.html#aa66b7725a5567b78a94e77bd286ca137">size</a>){</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <span class="keywordflow">if</span>(size == 0){</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                <span class="comment">// Nothing to invalidate</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            }</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            <span class="keyword">const</span> std::size_t <a class="code" href="write__buffer_8hpp_ab69ecf4d8b73d23210b6ca64bca23973.html#ab69ecf4d8b73d23210b6ca64bca23973">block_size</a> = <a class="code" href="swdsm_8h_a07958ee0efecb1f7c4fa09ecff2dd810.html#a07958ee0efecb1f7c4fa09ecff2dd810">page_size</a>*<a class="code" href="swdsm_8h_aa62717a1fae2c57f94f2a9b8ae08ec49.html#aa62717a1fae2c57f94f2a9b8ae08ec49">CACHELINE</a>;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            <span class="keyword">const</span> std::size_t start_address = <span class="keyword">reinterpret_cast&lt;</span>std::size_t<span class="keyword">&gt;</span>(argo::virtual_memory::start_address());</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            <span class="keyword">const</span> std::size_t page_misalignment = <span class="keyword">reinterpret_cast&lt;</span>std::size_t<span class="keyword">&gt;</span>(addr)%block_size;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            std::size_t argo_address =</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                ((<span class="keyword">reinterpret_cast&lt;</span>std::size_t<span class="keyword">&gt;</span>(addr)-start_address)/<a class="code" href="write__buffer_8hpp_ab69ecf4d8b73d23210b6ca64bca23973.html#ab69ecf4d8b73d23210b6ca64bca23973">block_size</a>)*block_size;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespaceargo_a0ca3d380462ccf3759360b320a5efd33.html#a0ca3d380462ccf3759360b320a5efd33">node_id_t</a> <a class="code" href="namespaceargo_a2deaaacde085d381cbb01f24318965b4.html#a2deaaacde085d381cbb01f24318965b4">node_id</a> = <a class="code" href="namespaceargo_a2deaaacde085d381cbb01f24318965b4.html#a2deaaacde085d381cbb01f24318965b4">argo::backend::node_id</a>();</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <span class="keyword">const</span> std::size_t node_id_bit = <span class="keyword">static_cast&lt;</span>std::size_t<span class="keyword">&gt;</span>(1) &lt;&lt; node_id;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            <span class="comment">// Lock relevant mutexes. Start statistics timekeeping</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            <span class="keywordtype">double</span> t1 = MPI_Wtime();</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            pthread_mutex_lock(&amp;<a class="code" href="coherence_8cpp_a2827de70f5388ba0f94110dccfde2f6e.html#a2827de70f5388ba0f94110dccfde2f6e">cachemutex</a>);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            sem_wait(&amp;<a class="code" href="coherence_8cpp_aecf80b1a87818049bb218f1029cbb271.html#aecf80b1a87818049bb218f1029cbb271">ibsem</a>);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <span class="comment">// Iterate over all pages to selectively invalidate</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            <span class="keywordflow">for</span>(std::size_t page_address = argo_address;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                    page_address &lt; argo_address + page_misalignment + <a class="code" href="tests_2allocators_8cpp_aa66b7725a5567b78a94e77bd286ca137.html#aa66b7725a5567b78a94e77bd286ca137">size</a>;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                    page_address += <a class="code" href="write__buffer_8hpp_ab69ecf4d8b73d23210b6ca64bca23973.html#ab69ecf4d8b73d23210b6ca64bca23973">block_size</a>){</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespaceargo_a0ca3d380462ccf3759360b320a5efd33.html#a0ca3d380462ccf3759360b320a5efd33">node_id_t</a> homenode_id = <a class="code" href="swdsm_8cpp_ac2a76a52d43c19cf7d5ed770e14c4409.html#ac2a76a52d43c19cf7d5ed770e14c4409">peek_homenode</a>(page_address);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                <span class="comment">// This page should be skipped in the following cases</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                <span class="comment">// 1. The page is node local so no acquire is necessary</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                <span class="comment">// 2. The page has not yet been first-touched and trying</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                <span class="comment">// to perform an acquire would first-touch the page</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                <span class="keywordflow">if</span>( homenode_id == node_id ||</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                    homenode_id == <a class="code" href="namespaceargo_1_1data__distribution_a88ff6bbc68aad43df4ae1cb78f6368bd.html#a88ff6bbc68aad43df4ae1cb78f6368bd">argo::data_distribution::invalid_node_id</a>) {</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                    <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                }</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                <span class="keyword">const</span> std::size_t cache_index = <a class="code" href="swdsm_8cpp_a59e4c59c2940cc3727debeeff4af1889.html#a59e4c59c2940cc3727debeeff4af1889">getCacheIndex</a>(page_address);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                <span class="keyword">const</span> std::size_t classification_index = <a class="code" href="swdsm_8cpp_aff9ea7ba7f37206d933c8dc8004dbc7b.html#aff9ea7ba7f37206d933c8dc8004dbc7b">get_classification_index</a>(page_address);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                <span class="comment">// If the page is dirty, downgrade it</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                <span class="keywordflow">if</span>(cacheControl[cache_index].dirty == <a class="code" href="swdsm_8h_a60932aba9f294e6d63e2bcaa085d4b8d.html#a60932aba9f294e6d63e2bcaa085d4b8d">DIRTY</a>){</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                    mprotect((<span class="keywordtype">char</span>*)start_address + page_address, block_size, PROT_READ);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt;<a class="code" href="swdsm_8h_aa62717a1fae2c57f94f2a9b8ae08ec49.html#aa62717a1fae2c57f94f2a9b8ae08ec49">CACHELINE</a>; i++){</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                        <a class="code" href="swdsm_8cpp_a3b6a6b2b244edb9faa79814ce8e5e9f5.html#a3b6a6b2b244edb9faa79814ce8e5e9f5">storepageDIFF</a>(cache_index+i,page_address+<a class="code" href="swdsm_8h_a07958ee0efecb1f7c4fa09ecff2dd810.html#a07958ee0efecb1f7c4fa09ecff2dd810">page_size</a>*i);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                    }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                    argo_write_buffer-&gt;<a class="code" href="classwrite__buffer_a1fe5684a5d07bd1418b0d66663f9bfdf.html#a1fe5684a5d07bd1418b0d66663f9bfdf">erase</a>(cache_index);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                    cacheControl[cache_index].<a class="code" href="structmyControlData_a6db6cf5782f7ca2f19dd4e6f6d0b9e43.html#a6db6cf5782f7ca2f19dd4e6f6d0b9e43">dirty</a> = <a class="code" href="swdsm_8h_a2315af8277ada7b9534af936c69891ce.html#a2315af8277ada7b9534af936c69891ce">CLEAN</a>;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                }</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                <span class="comment">// Optimization to keep pages in cache if they do not</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                <span class="comment">// need to be invalidated.</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                MPI_Win_lock(MPI_LOCK_SHARED, node_id, 0, <a class="code" href="coherence_8cpp_a52f5368613b8fb6e411ed9e2e738d97e.html#a52f5368613b8fb6e411ed9e2e738d97e">sharerWindow</a>);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                <span class="keywordflow">if</span>(</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                        <span class="comment">// node is single writer</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                        (<a class="code" href="coherence_8cpp_a8c349e3402bea4a398112f54fcfb7a0a.html#a8c349e3402bea4a398112f54fcfb7a0a">globalSharers</a>[classification_index+1] == node_id_bit)</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                        ||</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                        <span class="comment">// No writer and assert that the node is a sharer</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                        ((<a class="code" href="coherence_8cpp_a8c349e3402bea4a398112f54fcfb7a0a.html#a8c349e3402bea4a398112f54fcfb7a0a">globalSharers</a>[classification_index+1] == 0) &amp;&amp;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                         ((<a class="code" href="coherence_8cpp_a8c349e3402bea4a398112f54fcfb7a0a.html#a8c349e3402bea4a398112f54fcfb7a0a">globalSharers</a>[classification_index] &amp; node_id_bit) == node_id_bit))</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                  ){</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                    MPI_Win_unlock(node_id, <a class="code" href="coherence_8cpp_a52f5368613b8fb6e411ed9e2e738d97e.html#a52f5368613b8fb6e411ed9e2e738d97e">sharerWindow</a>);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                    <a class="code" href="coherence_8cpp_ac87b1e995ffe192a9cdd46c1686686c0.html#ac87b1e995ffe192a9cdd46c1686686c0">touchedcache</a>[cache_index]=1;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                    <span class="comment">//nothing - we keep the pages, SD is done in flushWB</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                <span class="keywordflow">else</span>{ <span class="comment">//multiple writer or SO, invalidate the page</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                    MPI_Win_unlock(node_id, <a class="code" href="coherence_8cpp_a52f5368613b8fb6e411ed9e2e738d97e.html#a52f5368613b8fb6e411ed9e2e738d97e">sharerWindow</a>);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                    cacheControl[cache_index].<a class="code" href="structmyControlData_a6db6cf5782f7ca2f19dd4e6f6d0b9e43.html#a6db6cf5782f7ca2f19dd4e6f6d0b9e43">dirty</a>=<a class="code" href="swdsm_8h_a2315af8277ada7b9534af936c69891ce.html#a2315af8277ada7b9534af936c69891ce">CLEAN</a>;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                    cacheControl[cache_index].<a class="code" href="structmyControlData_a74aa16e0dfe9276eb5f598545271dcf1.html#a74aa16e0dfe9276eb5f598545271dcf1">state</a> = <a class="code" href="swdsm_8h_a3aad0c262829e881d9cfa79db6223f05.html#a3aad0c262829e881d9cfa79db6223f05">INVALID</a>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                    <a class="code" href="coherence_8cpp_ac87b1e995ffe192a9cdd46c1686686c0.html#ac87b1e995ffe192a9cdd46c1686686c0">touchedcache</a>[cache_index]=0;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                    mprotect((<span class="keywordtype">char</span>*)start_address + page_address, block_size, PROT_NONE);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                }</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            }</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            <span class="comment">// Make sure to sync writebacks</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="namespaceargo_a79c9492f3fd441bfa6261dffbc0f02f4.html#a79c9492f3fd441bfa6261dffbc0f02f4">number_of_nodes</a>(); i++){</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="coherence_8cpp_a2707676433880430ff68f81f289f75b7.html#a2707676433880430ff68f81f289f75b7">barwindowsused</a>[i] == 1){</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                    MPI_Win_unlock(i, <a class="code" href="coherence_8cpp_aee30617402d0ccff2e61bc63a2a7b453.html#aee30617402d0ccff2e61bc63a2a7b453">globalDataWindow</a>[i]); <span class="comment">//Sync write backs</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                    <a class="code" href="coherence_8cpp_a2707676433880430ff68f81f289f75b7.html#a2707676433880430ff68f81f289f75b7">barwindowsused</a>[i] = 0;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                }</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="keywordtype">double</span> t2 = MPI_Wtime();</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            stats.<a class="code" href="structargo__statisticsStruct_a01b47069ed2617004ed7623a187c0810.html#a01b47069ed2617004ed7623a187c0810">ssitime</a> += t2-t1;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            <span class="comment">// Poke the MPI system to force progress</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <span class="keywordtype">int</span> flag;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            MPI_Iprobe(MPI_ANY_SOURCE,MPI_ANY_TAG,<a class="code" href="coherence_8cpp_ac506762549d2e2cd58c67e8f46428ea1.html#ac506762549d2e2cd58c67e8f46428ea1">workcomm</a>,&amp;flag,MPI_STATUS_IGNORE);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            <span class="comment">// Release relevant mutexes</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            sem_post(&amp;<a class="code" href="coherence_8cpp_aecf80b1a87818049bb218f1029cbb271.html#aecf80b1a87818049bb218f1029cbb271">ibsem</a>);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            pthread_mutex_unlock(&amp;<a class="code" href="coherence_8cpp_a2827de70f5388ba0f94110dccfde2f6e.html#a2827de70f5388ba0f94110dccfde2f6e">cachemutex</a>);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="backend_8hpp_ac3350bde3c8baf64753e515336fad3be.html#ac3350bde3c8baf64753e515336fad3be">  162</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="backend_8hpp_ac3350bde3c8baf64753e515336fad3be.html#ac3350bde3c8baf64753e515336fad3be">_selective_release</a>(<span class="keywordtype">void</span> *addr, std::size_t <a class="code" href="tests_2allocators_8cpp_aa66b7725a5567b78a94e77bd286ca137.html#aa66b7725a5567b78a94e77bd286ca137">size</a>){</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="keywordflow">if</span>(size == 0){</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                <span class="comment">// Nothing to downgrade</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            <span class="keyword">const</span> std::size_t <a class="code" href="write__buffer_8hpp_ab69ecf4d8b73d23210b6ca64bca23973.html#ab69ecf4d8b73d23210b6ca64bca23973">block_size</a> = <a class="code" href="swdsm_8h_a07958ee0efecb1f7c4fa09ecff2dd810.html#a07958ee0efecb1f7c4fa09ecff2dd810">page_size</a>*<a class="code" href="swdsm_8h_aa62717a1fae2c57f94f2a9b8ae08ec49.html#aa62717a1fae2c57f94f2a9b8ae08ec49">CACHELINE</a>;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            <span class="keyword">const</span> std::size_t start_address = <span class="keyword">reinterpret_cast&lt;</span>std::size_t<span class="keyword">&gt;</span>(argo::virtual_memory::start_address());</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            <span class="keyword">const</span> std::size_t page_misalignment = <span class="keyword">reinterpret_cast&lt;</span>std::size_t<span class="keyword">&gt;</span>(addr)%block_size;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            std::size_t argo_address =</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                ((<span class="keyword">reinterpret_cast&lt;</span>std::size_t<span class="keyword">&gt;</span>(addr)-start_address)/<a class="code" href="write__buffer_8hpp_ab69ecf4d8b73d23210b6ca64bca23973.html#ab69ecf4d8b73d23210b6ca64bca23973">block_size</a>)*block_size;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespaceargo_a0ca3d380462ccf3759360b320a5efd33.html#a0ca3d380462ccf3759360b320a5efd33">node_id_t</a> <a class="code" href="namespaceargo_a2deaaacde085d381cbb01f24318965b4.html#a2deaaacde085d381cbb01f24318965b4">node_id</a> = <a class="code" href="namespaceargo_a2deaaacde085d381cbb01f24318965b4.html#a2deaaacde085d381cbb01f24318965b4">argo::backend::node_id</a>();</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            <span class="comment">// Lock relevant mutexes. Start statistics timekeeping</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <span class="keywordtype">double</span> t1 = MPI_Wtime();</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            pthread_mutex_lock(&amp;<a class="code" href="coherence_8cpp_a2827de70f5388ba0f94110dccfde2f6e.html#a2827de70f5388ba0f94110dccfde2f6e">cachemutex</a>);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            sem_wait(&amp;<a class="code" href="coherence_8cpp_aecf80b1a87818049bb218f1029cbb271.html#aecf80b1a87818049bb218f1029cbb271">ibsem</a>);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <span class="comment">// Iterate over all pages to selectively downgrade</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            <span class="keywordflow">for</span>(std::size_t page_address = argo_address;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                    page_address &lt; argo_address + page_misalignment + <a class="code" href="tests_2allocators_8cpp_aa66b7725a5567b78a94e77bd286ca137.html#aa66b7725a5567b78a94e77bd286ca137">size</a>;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                    page_address += <a class="code" href="write__buffer_8hpp_ab69ecf4d8b73d23210b6ca64bca23973.html#ab69ecf4d8b73d23210b6ca64bca23973">block_size</a>){</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespaceargo_a0ca3d380462ccf3759360b320a5efd33.html#a0ca3d380462ccf3759360b320a5efd33">node_id_t</a> homenode_id = <a class="code" href="swdsm_8cpp_ac2a76a52d43c19cf7d5ed770e14c4409.html#ac2a76a52d43c19cf7d5ed770e14c4409">peek_homenode</a>(page_address);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                <span class="comment">// selective_release should be skipped in the following cases</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                <span class="comment">// 1. The page is node local so no release is necessary</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                <span class="comment">// 2. The page has not yet been first-touched and trying</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                <span class="comment">// to perform a release would first-touch the page</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                <span class="keywordflow">if</span>( homenode_id == node_id ||</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                    homenode_id == <a class="code" href="namespaceargo_1_1data__distribution_a88ff6bbc68aad43df4ae1cb78f6368bd.html#a88ff6bbc68aad43df4ae1cb78f6368bd">argo::data_distribution::invalid_node_id</a>) {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                    <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                <span class="keyword">const</span> std::size_t cache_index = <a class="code" href="swdsm_8cpp_a59e4c59c2940cc3727debeeff4af1889.html#a59e4c59c2940cc3727debeeff4af1889">getCacheIndex</a>(page_address);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                <span class="comment">// If the page is dirty, downgrade it</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                <span class="keywordflow">if</span>(cacheControl[cache_index].dirty == <a class="code" href="swdsm_8h_a60932aba9f294e6d63e2bcaa085d4b8d.html#a60932aba9f294e6d63e2bcaa085d4b8d">DIRTY</a>){</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                    mprotect((<span class="keywordtype">char</span>*)start_address + page_address, block_size, PROT_READ);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt;<a class="code" href="swdsm_8h_aa62717a1fae2c57f94f2a9b8ae08ec49.html#aa62717a1fae2c57f94f2a9b8ae08ec49">CACHELINE</a>; i++){</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                        <a class="code" href="swdsm_8cpp_a3b6a6b2b244edb9faa79814ce8e5e9f5.html#a3b6a6b2b244edb9faa79814ce8e5e9f5">storepageDIFF</a>(cache_index+i,page_address+<a class="code" href="swdsm_8h_a07958ee0efecb1f7c4fa09ecff2dd810.html#a07958ee0efecb1f7c4fa09ecff2dd810">page_size</a>*i);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                    }</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                    argo_write_buffer-&gt;<a class="code" href="classwrite__buffer_a1fe5684a5d07bd1418b0d66663f9bfdf.html#a1fe5684a5d07bd1418b0d66663f9bfdf">erase</a>(cache_index);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                    cacheControl[cache_index].<a class="code" href="structmyControlData_a6db6cf5782f7ca2f19dd4e6f6d0b9e43.html#a6db6cf5782f7ca2f19dd4e6f6d0b9e43">dirty</a> = <a class="code" href="swdsm_8h_a2315af8277ada7b9534af936c69891ce.html#a2315af8277ada7b9534af936c69891ce">CLEAN</a>;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                }</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <span class="comment">// Make sure to sync writebacks</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="namespaceargo_a79c9492f3fd441bfa6261dffbc0f02f4.html#a79c9492f3fd441bfa6261dffbc0f02f4">number_of_nodes</a>(); i++){</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="coherence_8cpp_a2707676433880430ff68f81f289f75b7.html#a2707676433880430ff68f81f289f75b7">barwindowsused</a>[i] == 1){</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                    MPI_Win_unlock(i, <a class="code" href="coherence_8cpp_aee30617402d0ccff2e61bc63a2a7b453.html#aee30617402d0ccff2e61bc63a2a7b453">globalDataWindow</a>[i]); <span class="comment">//Sync write backs</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                    <a class="code" href="coherence_8cpp_a2707676433880430ff68f81f289f75b7.html#a2707676433880430ff68f81f289f75b7">barwindowsused</a>[i] = 0;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <span class="keywordtype">double</span> t2 = MPI_Wtime();</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            stats.<a class="code" href="structargo__statisticsStruct_a7820130d7038f2b91e9610e7602218e7.html#a7820130d7038f2b91e9610e7602218e7">ssdtime</a> += t2-t1;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <span class="comment">// Poke the MPI system to force progress</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            <span class="keywordtype">int</span> flag;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            MPI_Iprobe(MPI_ANY_SOURCE,MPI_ANY_TAG,<a class="code" href="coherence_8cpp_ac506762549d2e2cd58c67e8f46428ea1.html#ac506762549d2e2cd58c67e8f46428ea1">workcomm</a>,&amp;flag,MPI_STATUS_IGNORE);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <span class="comment">// Release relevant mutexes</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            sem_post(&amp;<a class="code" href="coherence_8cpp_aecf80b1a87818049bb218f1029cbb271.html#aecf80b1a87818049bb218f1029cbb271">ibsem</a>);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            pthread_mutex_unlock(&amp;<a class="code" href="coherence_8cpp_a2827de70f5388ba0f94110dccfde2f6e.html#a2827de70f5388ba0f94110dccfde2f6e">cachemutex</a>);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        }</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    } <span class="comment">//namespace backend</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;} <span class="comment">//namespace argo</span></div><div class="ttc" id="namespaceargo_a0ca3d380462ccf3759360b320a5efd33_html_a0ca3d380462ccf3759360b320a5efd33"><div class="ttname"><a href="namespaceargo_a0ca3d380462ccf3759360b320a5efd33.html#a0ca3d380462ccf3759360b320a5efd33">argo::node_id_t</a></div><div class="ttdeci">int node_id_t</div><div class="ttdoc">ArgoDSM node identifier type. </div><div class="ttdef"><b>Definition:</b> <a href="types_8hpp_source.html#l00012">types.hpp:12</a></div></div>
<div class="ttc" id="swdsm_8h_a07958ee0efecb1f7c4fa09ecff2dd810_html_a07958ee0efecb1f7c4fa09ecff2dd810"><div class="ttname"><a href="swdsm_8h_a07958ee0efecb1f7c4fa09ecff2dd810.html#a07958ee0efecb1f7c4fa09ecff2dd810">page_size</a></div><div class="ttdeci">constexpr std::size_t page_size</div><div class="ttdoc">The size of a hardware memory page. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8h_source.html#l00124">swdsm.h:124</a></div></div>
<div class="ttc" id="write__buffer_8hpp_ab69ecf4d8b73d23210b6ca64bca23973_html_ab69ecf4d8b73d23210b6ca64bca23973"><div class="ttname"><a href="write__buffer_8hpp_ab69ecf4d8b73d23210b6ca64bca23973.html#ab69ecf4d8b73d23210b6ca64bca23973">block_size</a></div><div class="ttdeci">const std::size_t block_size</div><div class="ttdoc">Block size based on backend definition. </div><div class="ttdef"><b>Definition:</b> <a href="write__buffer_8hpp_source.html#l00046">write_buffer.hpp:46</a></div></div>
<div class="ttc" id="swdsm_8h_a60932aba9f294e6d63e2bcaa085d4b8d_html_a60932aba9f294e6d63e2bcaa085d4b8d"><div class="ttname"><a href="swdsm_8h_a60932aba9f294e6d63e2bcaa085d4b8d.html#a60932aba9f294e6d63e2bcaa085d4b8d">DIRTY</a></div><div class="ttdeci">static const argo_byte DIRTY</div><div class="ttdoc">Constant for dirty states. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8h_source.html#l00113">swdsm.h:113</a></div></div>
<div class="ttc" id="classwrite__buffer_html"><div class="ttname"><a href="classwrite__buffer.html">write_buffer</a></div><div class="ttdoc">A write buffer in FIFO style with the capability to erase any element from the buffer while preservin...</div><div class="ttdef"><b>Definition:</b> <a href="write__buffer_8hpp_source.html#l00054">write_buffer.hpp:54</a></div></div>
<div class="ttc" id="write__buffer_8hpp_html"><div class="ttname"><a href="write__buffer_8hpp.html">write_buffer.hpp</a></div><div class="ttdoc">This file provides an interface for the ArgoDSM write buffer. </div></div>
<div class="ttc" id="structargo__statisticsStruct_a7820130d7038f2b91e9610e7602218e7_html_a7820130d7038f2b91e9610e7602218e7"><div class="ttname"><a href="structargo__statisticsStruct_a7820130d7038f2b91e9610e7602218e7.html#a7820130d7038f2b91e9610e7602218e7">argo_statisticsStruct::ssdtime</a></div><div class="ttdeci">double ssdtime</div><div class="ttdoc">Time spent performing selective release. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8h_source.html#l00102">swdsm.h:102</a></div></div>
<div class="ttc" id="tests_2allocators_8cpp_aa66b7725a5567b78a94e77bd286ca137_html_aa66b7725a5567b78a94e77bd286ca137"><div class="ttname"><a href="tests_2allocators_8cpp_aa66b7725a5567b78a94e77bd286ca137.html#aa66b7725a5567b78a94e77bd286ca137">size</a></div><div class="ttdeci">constexpr std::size_t size</div><div class="ttdoc">ArgoDSM memory size. </div><div class="ttdef"><b>Definition:</b> <a href="tests_2allocators_8cpp_source.html#l00021">allocators.cpp:21</a></div></div>
<div class="ttc" id="virtual__memory_8hpp_html"><div class="ttname"><a href="virtual__memory_8hpp.html">virtual_memory.hpp</a></div><div class="ttdoc">This file provides facilities for handling virtual memory and virtual address space. </div></div>
<div class="ttc" id="namespaceargo_a2deaaacde085d381cbb01f24318965b4_html_a2deaaacde085d381cbb01f24318965b4"><div class="ttname"><a href="namespaceargo_a2deaaacde085d381cbb01f24318965b4.html#a2deaaacde085d381cbb01f24318965b4">argo::node_id</a></div><div class="ttdeci">int node_id()</div><div class="ttdoc">A unique ArgoDSM node identifier. Counting starts from 0. </div><div class="ttdef"><b>Definition:</b> <a href="argo_8cpp_source.html#l00068">argo.cpp:68</a></div></div>
<div class="ttc" id="backend_8hpp_a0fb29a8253f0d9aefc999d93414b1758_html_a0fb29a8253f0d9aefc999d93414b1758"><div class="ttname"><a href="backend_8hpp_a0fb29a8253f0d9aefc999d93414b1758.html#a0fb29a8253f0d9aefc999d93414b1758">argo::backend::_selective_acquire</a></div><div class="ttdeci">void _selective_acquire(void *addr, std::size_t size)</div><div class="ttdoc">backend internal type erased function for selective acquire </div><div class="ttdef"><b>Definition:</b> <a href="coherence_8cpp_source.html#l00073">coherence.cpp:73</a></div></div>
<div class="ttc" id="coherence_8cpp_aee30617402d0ccff2e61bc63a2a7b453_html_aee30617402d0ccff2e61bc63a2a7b453"><div class="ttname"><a href="coherence_8cpp_aee30617402d0ccff2e61bc63a2a7b453.html#aee30617402d0ccff2e61bc63a2a7b453">globalDataWindow</a></div><div class="ttdeci">MPI_Win * globalDataWindow</div><div class="ttdoc">globalDataWindows need to be explicitly closed by the caller of storepageDIFF </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8cpp_source.html#l00069">swdsm.cpp:69</a></div></div>
<div class="ttc" id="coherence_8cpp_aecf80b1a87818049bb218f1029cbb271_html_aecf80b1a87818049bb218f1029cbb271"><div class="ttname"><a href="coherence_8cpp_aecf80b1a87818049bb218f1029cbb271.html#aecf80b1a87818049bb218f1029cbb271">ibsem</a></div><div class="ttdeci">sem_t ibsem</div><div class="ttdoc">ibsem is used to serialize all Infiniband (MPI) operations </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8cpp_source.html#l00084">swdsm.cpp:84</a></div></div>
<div class="ttc" id="swdsm_8cpp_ac2a76a52d43c19cf7d5ed770e14c4409_html_ac2a76a52d43c19cf7d5ed770e14c4409"><div class="ttname"><a href="swdsm_8cpp_ac2a76a52d43c19cf7d5ed770e14c4409.html#ac2a76a52d43c19cf7d5ed770e14c4409">peek_homenode</a></div><div class="ttdeci">argo::node_id_t peek_homenode(std::uintptr_t addr)</div><div class="ttdoc">Gives homenode for a given address. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8cpp_source.html#l00456">swdsm.cpp:456</a></div></div>
<div class="ttc" id="coherence_8cpp_a2827de70f5388ba0f94110dccfde2f6e_html_a2827de70f5388ba0f94110dccfde2f6e"><div class="ttname"><a href="coherence_8cpp_a2827de70f5388ba0f94110dccfde2f6e.html#a2827de70f5388ba0f94110dccfde2f6e">cachemutex</a></div><div class="ttdeci">pthread_mutex_t cachemutex</div><div class="ttdoc">A cache mutex protects all operations on cacheControl. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8cpp_source.html#l00051">swdsm.cpp:51</a></div></div>
<div class="ttc" id="backend_8hpp_ac3350bde3c8baf64753e515336fad3be_html_ac3350bde3c8baf64753e515336fad3be"><div class="ttname"><a href="backend_8hpp_ac3350bde3c8baf64753e515336fad3be.html#ac3350bde3c8baf64753e515336fad3be">argo::backend::_selective_release</a></div><div class="ttdeci">void _selective_release(void *addr, std::size_t size)</div><div class="ttdoc">backend internal type erased function for selective release </div><div class="ttdef"><b>Definition:</b> <a href="coherence_8cpp_source.html#l00162">coherence.cpp:162</a></div></div>
<div class="ttc" id="swdsm_8h_aa62717a1fae2c57f94f2a9b8ae08ec49_html_aa62717a1fae2c57f94f2a9b8ae08ec49"><div class="ttname"><a href="swdsm_8h_aa62717a1fae2c57f94f2a9b8ae08ec49.html#aa62717a1fae2c57f94f2a9b8ae08ec49">CACHELINE</a></div><div class="ttdeci">#define CACHELINE</div><div class="ttdoc">Size of a ArgoDSM cacheline in number of pages. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8h_source.html#l00039">swdsm.h:39</a></div></div>
<div class="ttc" id="classwrite__buffer_a1fe5684a5d07bd1418b0d66663f9bfdf_html_a1fe5684a5d07bd1418b0d66663f9bfdf"><div class="ttname"><a href="classwrite__buffer_a1fe5684a5d07bd1418b0d66663f9bfdf.html#a1fe5684a5d07bd1418b0d66663f9bfdf">write_buffer::erase</a></div><div class="ttdeci">void erase(T val)</div><div class="ttdoc">If val exists in buffer, delete it. Else, do nothing. </div><div class="ttdef"><b>Definition:</b> <a href="write__buffer_8hpp_source.html#l00229">write_buffer.hpp:229</a></div></div>
<div class="ttc" id="structargo__statisticsStruct_html"><div class="ttname"><a href="structargo__statisticsStruct.html">argo_statisticsStruct</a></div><div class="ttdoc">Struct containing statistics. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8h_source.html#l00073">swdsm.h:73</a></div></div>
<div class="ttc" id="swdsm_8cpp_a3b6a6b2b244edb9faa79814ce8e5e9f5_html_a3b6a6b2b244edb9faa79814ce8e5e9f5"><div class="ttname"><a href="swdsm_8cpp_a3b6a6b2b244edb9faa79814ce8e5e9f5.html#a3b6a6b2b244edb9faa79814ce8e5e9f5">storepageDIFF</a></div><div class="ttdeci">void storepageDIFF(std::size_t index, std::uintptr_t addr)</div><div class="ttdoc">stores a page remotely - only writing back what has been written locally since last synchronization p...</div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8cpp_source.html#l01119">swdsm.cpp:1119</a></div></div>
<div class="ttc" id="coherence_8cpp_a52f5368613b8fb6e411ed9e2e738d97e_html_a52f5368613b8fb6e411ed9e2e738d97e"><div class="ttname"><a href="coherence_8cpp_a52f5368613b8fb6e411ed9e2e738d97e.html#a52f5368613b8fb6e411ed9e2e738d97e">sharerWindow</a></div><div class="ttdeci">MPI_Win sharerWindow</div><div class="ttdoc">sharerWindow protects the pyxis directory </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8cpp_source.html#l00067">swdsm.cpp:67</a></div></div>
<div class="ttc" id="structmyControlData_a6db6cf5782f7ca2f19dd4e6f6d0b9e43_html_a6db6cf5782f7ca2f19dd4e6f6d0b9e43"><div class="ttname"><a href="structmyControlData_a6db6cf5782f7ca2f19dd4e6f6d0b9e43.html#a6db6cf5782f7ca2f19dd4e6f6d0b9e43">myControlData::dirty</a></div><div class="ttdeci">argo_byte dirty</div><div class="ttdoc">Tracks if page is dirty or clean. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8h_source.html#l00067">swdsm.h:67</a></div></div>
<div class="ttc" id="structmyControlData_html"><div class="ttname"><a href="structmyControlData.html">myControlData</a></div><div class="ttdoc">Struct for cache control data. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8h_source.html#l00062">swdsm.h:62</a></div></div>
<div class="ttc" id="coherence_8cpp_a5a165c3e2fa2511a6beea1dcb9b7462e_html_a5a165c3e2fa2511a6beea1dcb9b7462e"><div class="ttname"><a href="coherence_8cpp_a5a165c3e2fa2511a6beea1dcb9b7462e.html#a5a165c3e2fa2511a6beea1dcb9b7462e">stats</a></div><div class="ttdeci">argo_statistics stats</div><div class="ttdoc">Needed to update argo statistics. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8cpp_source.html#l00108">swdsm.cpp:108</a></div></div>
<div class="ttc" id="coherence_8cpp_ac87b1e995ffe192a9cdd46c1686686c0_html_ac87b1e995ffe192a9cdd46c1686686c0"><div class="ttname"><a href="coherence_8cpp_ac87b1e995ffe192a9cdd46c1686686c0.html#ac87b1e995ffe192a9cdd46c1686686c0">touchedcache</a></div><div class="ttdeci">argo_byte * touchedcache</div><div class="ttdoc">Needed to update information about cache pages touched. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8cpp_source.html#l00045">swdsm.cpp:45</a></div></div>
<div class="ttc" id="coherence_8cpp_a8c349e3402bea4a398112f54fcfb7a0a_html_a8c349e3402bea4a398112f54fcfb7a0a"><div class="ttname"><a href="coherence_8cpp_a8c349e3402bea4a398112f54fcfb7a0a.html#a8c349e3402bea4a398112f54fcfb7a0a">globalSharers</a></div><div class="ttdeci">std::uint64_t * globalSharers</div><div class="ttdoc">globalSharers is needed to access and modify the pyxis directory </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8cpp_source.html#l00041">swdsm.cpp:41</a></div></div>
<div class="ttc" id="coherence_8cpp_a47bd1cf6b67fdc3919a12b2c622b0ae9_html_a47bd1cf6b67fdc3919a12b2c622b0ae9"><div class="ttname"><a href="coherence_8cpp_a47bd1cf6b67fdc3919a12b2c622b0ae9.html#a47bd1cf6b67fdc3919a12b2c622b0ae9">cacheControl</a></div><div class="ttdeci">control_data * cacheControl</div><div class="ttdoc">This is needed to access page information from the cache. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8cpp_source.html#l00039">swdsm.cpp:39</a></div></div>
<div class="ttc" id="swdsm_8h_a2315af8277ada7b9534af936c69891ce_html_a2315af8277ada7b9534af936c69891ce"><div class="ttname"><a href="swdsm_8h_a2315af8277ada7b9534af936c69891ce.html#a2315af8277ada7b9534af936c69891ce">CLEAN</a></div><div class="ttdeci">static const argo_byte CLEAN</div><div class="ttdoc">Constant for clean states. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8h_source.html#l00111">swdsm.h:111</a></div></div>
<div class="ttc" id="namespaceargo_1_1data__distribution_a88ff6bbc68aad43df4ae1cb78f6368bd_html_a88ff6bbc68aad43df4ae1cb78f6368bd"><div class="ttname"><a href="namespaceargo_1_1data__distribution_a88ff6bbc68aad43df4ae1cb78f6368bd.html#a88ff6bbc68aad43df4ae1cb78f6368bd">argo::data_distribution::invalid_node_id</a></div><div class="ttdeci">constexpr argo::node_id_t invalid_node_id</div><div class="ttdoc">This constant is used to represent an invalid node id. </div><div class="ttdef"><b>Definition:</b> <a href="base__distribution_8hpp_source.html#l00020">base_distribution.hpp:20</a></div></div>
<div class="ttc" id="structargo__statisticsStruct_a01b47069ed2617004ed7623a187c0810_html_a01b47069ed2617004ed7623a187c0810"><div class="ttname"><a href="structargo__statisticsStruct_a01b47069ed2617004ed7623a187c0810.html#a01b47069ed2617004ed7623a187c0810">argo_statisticsStruct::ssitime</a></div><div class="ttdeci">double ssitime</div><div class="ttdoc">Time spent performing selective acquire. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8h_source.html#l00100">swdsm.h:100</a></div></div>
<div class="ttc" id="swdsm_8h_a7c9ba35a9f54dd8fa5a49d55e2768763_html_a7c9ba35a9f54dd8fa5a49d55e2768763"><div class="ttname"><a href="swdsm_8h_a7c9ba35a9f54dd8fa5a49d55e2768763.html#a7c9ba35a9f54dd8fa5a49d55e2768763">argo_byte</a></div><div class="ttdeci">unsigned char argo_byte</div><div class="ttdoc">Wrapper for unsigned char - basically a byte. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8h_source.html#l00059">swdsm.h:59</a></div></div>
<div class="ttc" id="swdsm_8h_a3aad0c262829e881d9cfa79db6223f05_html_a3aad0c262829e881d9cfa79db6223f05"><div class="ttname"><a href="swdsm_8h_a3aad0c262829e881d9cfa79db6223f05.html#a3aad0c262829e881d9cfa79db6223f05">INVALID</a></div><div class="ttdeci">static const argo_byte INVALID</div><div class="ttdoc">Constant for invalid states. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8h_source.html#l00107">swdsm.h:107</a></div></div>
<div class="ttc" id="coherence_8cpp_aa2b2930f8400209562515c100a4ed0da_html_aa2b2930f8400209562515c100a4ed0da"><div class="ttname"><a href="coherence_8cpp_aa2b2930f8400209562515c100a4ed0da.html#aa2b2930f8400209562515c100a4ed0da">argo_write_buffer</a></div><div class="ttdeci">write_buffer&lt; std::size_t &gt; * argo_write_buffer</div><div class="ttdoc">Write buffer to ensure selectively handled pages can be removed. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8cpp_source.html#l00055">swdsm.cpp:55</a></div></div>
<div class="ttc" id="namespaceargo_html"><div class="ttname"><a href="namespaceargo.html">argo</a></div><div class="ttdoc">ArgoDSM namespace. </div><div class="ttdef"><b>Definition:</b> <a href="allocators_8hpp_source.html#l00013">allocators.hpp:13</a></div></div>
<div class="ttc" id="structmyControlData_a74aa16e0dfe9276eb5f598545271dcf1_html_a74aa16e0dfe9276eb5f598545271dcf1"><div class="ttname"><a href="structmyControlData_a74aa16e0dfe9276eb5f598545271dcf1.html#a74aa16e0dfe9276eb5f598545271dcf1">myControlData::state</a></div><div class="ttdeci">argo_byte state</div><div class="ttdoc">Coherence state, basically only Valid/Invalid now. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8h_source.html#l00065">swdsm.h:65</a></div></div>
<div class="ttc" id="namespaceargo_a79c9492f3fd441bfa6261dffbc0f02f4_html_a79c9492f3fd441bfa6261dffbc0f02f4"><div class="ttname"><a href="namespaceargo_a79c9492f3fd441bfa6261dffbc0f02f4.html#a79c9492f3fd441bfa6261dffbc0f02f4">argo::number_of_nodes</a></div><div class="ttdeci">int number_of_nodes()</div><div class="ttdoc">Number of ArgoDSM nodes being run. </div><div class="ttdef"><b>Definition:</b> <a href="argo_8cpp_source.html#l00072">argo.cpp:72</a></div></div>
<div class="ttc" id="swdsm_8cpp_a59e4c59c2940cc3727debeeff4af1889_html_a59e4c59c2940cc3727debeeff4af1889"><div class="ttname"><a href="swdsm_8cpp_a59e4c59c2940cc3727debeeff4af1889.html#a59e4c59c2940cc3727debeeff4af1889">getCacheIndex</a></div><div class="ttdeci">std::size_t getCacheIndex(std::uintptr_t addr)</div><div class="ttdoc">Gets cacheindex for a given address. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8cpp_source.html#l00188">swdsm.cpp:188</a></div></div>
<div class="ttc" id="swdsm_8cpp_aff9ea7ba7f37206d933c8dc8004dbc7b_html_aff9ea7ba7f37206d933c8dc8004dbc7b"><div class="ttname"><a href="swdsm_8cpp_aff9ea7ba7f37206d933c8dc8004dbc7b.html#aff9ea7ba7f37206d933c8dc8004dbc7b">get_classification_index</a></div><div class="ttdeci">std::size_t get_classification_index(std::uintptr_t addr)</div><div class="ttdoc">Gives an index to the sharer/writer vector depending on the address. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8cpp_source.html#l01177">swdsm.cpp:1177</a></div></div>
<div class="ttc" id="coherence_8cpp_a2707676433880430ff68f81f289f75b7_html_a2707676433880430ff68f81f289f75b7"><div class="ttname"><a href="coherence_8cpp_a2707676433880430ff68f81f289f75b7.html#a2707676433880430ff68f81f289f75b7">barwindowsused</a></div><div class="ttdeci">char * barwindowsused</div><div class="ttdoc">barwindowsused is needed to know which globalDataWindows to close. </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8cpp_source.html#l00081">swdsm.cpp:81</a></div></div>
<div class="ttc" id="swdsm_8h_html"><div class="ttname"><a href="swdsm_8h.html">swdsm.h</a></div><div class="ttdoc">this is a legacy file from the ArgoDSM prototype </div></div>
<div class="ttc" id="coherence_8cpp_ac506762549d2e2cd58c67e8f46428ea1_html_ac506762549d2e2cd58c67e8f46428ea1"><div class="ttname"><a href="coherence_8cpp_ac506762549d2e2cd58c67e8f46428ea1.html#ac506762549d2e2cd58c67e8f46428ea1">workcomm</a></div><div class="ttdeci">MPI_Comm workcomm</div><div class="ttdoc">workcomm is needed to poke the MPI system during one sided RMA </div><div class="ttdef"><b>Definition:</b> <a href="swdsm_8cpp_source.html#l00065">swdsm.cpp:65</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Mar 22 2022 19:34:56 for ArgoDSM - Software Distributed Shared Memory by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
